import tkinter as tk
from tkinter import messagebox, ttk
import openpyxl
from openpyxl.styles import PatternFill
import os

# Path file
DATA_PELAJAR_PATH = r"C:\Users\Administrator\Documents\Learning Pyhton coding studio 15Nov25\project\data_pelajar.xlsx"
HASIL_UJIAN_PATH = r"C:\Users\Administrator\Documents\Learning Pyhton coding studio 15Nov25\project\hasil_ujian.xlsx"

# List untuk menyimpan data sementara
data_entries = []

# Fungsi untuk membaca daftar nama pelajar dari Excel
def baca_daftar_pelajar():
    if not os.path.exists(DATA_PELAJAR_PATH):
        messagebox.showerror("Error", f"File {DATA_PELAJAR_PATH} tidak ditemukan!")
        return []
    wb = openpyxl.load_workbook(DATA_PELAJAR_PATH)
    sheet = wb.active
    daftar_nama = []
    for row in sheet.iter_rows(min_row=2, values_only=True):  # Asumsi baris 1 adalah header, kolom A adalah nama
        if row[0]:  # Kolom pertama (nama pelajar)
            daftar_nama.append(row[0].strip().lower())
    wb.close()
    return daftar_nama

# Fungsi untuk menentukan status kelulusan
def tentukan_status(nilai):
    if nilai >= 95:
        return "A / Lulus (Sempurna)"
    elif 85 <= nilai <= 94:
        return "A- / Lulus (Sangat Memuaskan)"
    elif 80 <= nilai <= 84:
        return "B+ / Lulus (Memuaskan)"
    elif 75 <= nilai <= 79:
        return "B / Lulus (Cukup)"
    else:
        return "Tidak Lulus"

# Fungsi untuk menambah entry ke list
def tambah_entry():
    tanggal = entry_tanggal.get().strip()
    nama = entry_nama.get().strip()
    mata_pelajaran = entry_mata.get().strip()
    try:
        nilai = float(entry_nilai.get().strip())
    except ValueError:
        messagebox.showerror("Error", "Nilai ujian harus berupa angka!")
        return
    
    if not tanggal or not nama or not mata_pelajaran:
        messagebox.showerror("Error", "Semua field harus diisi!")
        return
    
    daftar_nama = baca_daftar_pelajar()
    if nama.lower() not in daftar_nama:
        messagebox.showerror("Error", "Nama pelajar tidak diketahui!")
        return
    
    status = tentukan_status(nilai)
    data_entries.append((tanggal, nama, mata_pelajaran, status, nilai))
    
    # Update tabel tampilan
    tree.insert("", "end", values=(tanggal, nama, mata_pelajaran, status))
    
    # Clear fields
    entry_tanggal.delete(0, tk.END)
    entry_nama.delete(0, tk.END)
    entry_mata.delete(0, tk.END)
    entry_nilai.delete(0, tk.END)
    
    messagebox.showinfo("Sukses", "Entry ditambahkan. Klik 'Input Selesai' untuk menyimpan semua.")

# Fungsi untuk menyimpan semua data ke Excel
def selesai_input():
    if not data_entries:
        messagebox.showwarning("Peringatan", "Tidak ada data untuk disimpan!")
        return
    
    wb = openpyxl.Workbook()
    sheet = wb.active
    sheet.title = "Hasil Ujian"
    
    # Header
    sheet['A1'] = 'Tanggal Ujian'
    sheet['B1'] = 'Nama Pelajar'
    sheet['C1'] = 'Mata Pelajaran'
    sheet['D1'] = 'Status Kelulusan'
    
    # Data
    for i, (tanggal, nama, mata_pelajaran, status, nilai) in enumerate(data_entries, start=2):
        sheet[f'A{i}'] = tanggal
        sheet[f'B{i}'] = nama
        sheet[f'C{i}'] = mata_pelajaran
        sheet[f'D{i}'] = status
        
        # Pewarnaan: Jika nilai >= 75, warnai seluruh baris hijau
        if nilai >= 75:
            fill = PatternFill(start_color="00FF00", end_color="00FF00", fill_type="solid")  # Hijau
            for cell in sheet[i]:  # Baris i
                cell.fill = fill
    
    wb.save(HASIL_UJIAN_PATH)
    wb.close()
    
    messagebox.showinfo("Sukses", f"Semua data berhasil disimpan ke {HASIL_UJIAN_PATH}")
    
    # Clear data_entries dan tabel
    data_entries.clear()
    for item in tree.get_children():
        tree.delete(item)

# GUI dengan Tkinter
root = tk.Tk()
root.title("Penilaian Kelulusan Siswa")
root.geometry("600x500")

# Frame untuk input
frame_input = tk.Frame(root)
frame_input.pack(pady=10)

tk.Label(frame_input, text="Tanggal Ujian (YYYY-MM-DD):").grid(row=0, column=0, padx=5, pady=5)
entry_tanggal = tk.Entry(frame_input)
entry_tanggal.grid(row=0, column=1, padx=5, pady=5)

tk.Label(frame_input, text="Nama Pelajar:").grid(row=1, column=0, padx=5, pady=5)
entry_nama = tk.Entry(frame_input)
entry_nama.grid(row=1, column=1, padx=5, pady=5)

tk.Label(frame_input, text="Mata Pelajaran:").grid(row=2, column=0, padx=5, pady=5)
entry_mata = tk.Entry(frame_input)
entry_mata.grid(row=2, column=1, padx=5, pady=5)

tk.Label(frame_input, text="Nilai Ujian Final:").grid(row=3, column=0, padx=5, pady=5)
entry_nilai = tk.Entry(frame_input)
entry_nilai.grid(row=3, column=1, padx=5, pady=5)

# Tombol Tambah Entry
tk.Button(frame_input, text="Tambah Entry", command=tambah_entry).grid(row=4, column=0, columnspan=2, pady=10)

# Tombol Input Selesai
tk.Button(root, text="Input Selesai", command=selesai_input).pack(pady=10)

# Tabel untuk menampilkan data yang telah diinput
tree = ttk.Treeview(root, columns=("Tanggal", "Nama", "Mata Pelajaran", "Status"), show="headings")
tree.heading("Tanggal", text="Tanggal Ujian")
tree.heading("Nama", text="Nama Pelajar")
tree.heading("Mata Pelajaran", text="Mata Pelajaran")
tree.heading("Status", text="Status Kelulusan")
tree.pack(pady=10, fill=tk.BOTH, expand=True)

root.mainloop()
